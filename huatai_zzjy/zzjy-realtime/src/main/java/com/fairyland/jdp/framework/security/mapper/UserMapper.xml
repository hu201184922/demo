<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fairyland.jdp.framework.security.mapper.UserMapper">
	
	<update id="setUserDisabled" >
		UPDATE  JDP_USER T SET T.ENABLED_=0  WHERE (SYSDATE - (T.LAST_LOGINED_TIME + 0) >= 60 OR
	       (T.LAST_LOGINED_TIME IS NULL AND
	       SYSDATE - (T.REGISTER_DATE + 0) >= 60))
	   AND (IS_ADMIN != 1 OR IS_ADMIN IS NULL)

	</update>
	
	<select id="getUsersByParams" parameterType="com.fairyland.jdp.framework.security.domain.User" resultType="com.fairyland.jdp.framework.security.domain.User">
		SELECT A.CID AS ID,
		      A.ACCOUNT as account,
		      A.USERNAME as userName,
		      A.PUSER_ID AS PUSERID,
		      A.SEX as sex,
		      A.PHONE as phone,
		      A.EMAIL as email,
		      A.ACCOUNTSTATE as accountstate,
		      A.DESCRIPTION as description,
		      A.ENABLED_ AS enabled
		FROM JDP_USER A
		<where> 1=1
		        <if test="istype == null">
		        	AND A.ISTYPE = #{istype}
		        </if>
				<if test="orgCode == null">
					AND A.org_code = #{orgCode}
				</if>
				<if test="account != null">
				AND A.ACCOUNT LIKE '%'||#{account}||'%'
				</if>
				<if test="accountstate != null">
				AND A.ACCOUNTSTATE = #{accountstate}
				</if>
				<if test="roleId != null">
				AND A.role_id = #{roleId}
				</if>
				<if test="userName != null">
				AND A.USERNAME like '%'||#{userName}||'%'
				</if>
		</where>
	</select>
	
	<select id="getUsersByExample" parameterType="com.fairyland.jdp.framework.security.domain.User" resultType="com.fairyland.jdp.framework.security.domain.User">
		SELECT A.CID AS ID,
		      A.ACCOUNT as account,
		      A.USERNAME as userName,
		      A.PUSER_ID AS PUSERID,
		      A.SEX as sex,
		      A.PHONE as phone,
		      A.EMAIL as email,
		      A.ACCOUNTSTATE as accountstate,
		      A.DESCRIPTION as description,
		      A.ENABLED_ AS enabled
		FROM JDP_USER A
		<where> 1=1
		        <if test="isType == null">
		        	AND A.ISTYPE = #{isType}
		        </if>
				<if test="orgCode == null">
					AND A.org_code = #{orgCode}
				</if>
				<if test="account != null">
				AND A.ACCOUNT LIKE '%'||#{account}||'%'
				</if>
				<if test="accountstate != null">
				AND A.ACCOUNTSTATE = #{accountstate}
				</if>
				<if test="roleId != null">
				AND A.role_id = #{roleId}
				</if>
				<if test="userName != null">
				AND A.USERNAME like '%'||#{userName}||'%'
				</if>
		</where>
	</select>
	
	<select id="getUsersByExample2" parameterType="com.fairyland.jdp.framework.security.domain.User" resultType="com.fairyland.jdp.framework.security.domain.User">
		SELECT A.CID AS ID,
		      A.ACCOUNT as account,
		      A.USERNAME as userName,
		      A.PUSER_ID AS PUSERID,
		      A.SEX as sex,
		      A.PHONE as phone,
		      A.EMAIL as email,
		      A.ACCOUNTSTATE as accountstate,
		      A.DESCRIPTION as description,
		      A.ENABLED_ AS enabled
		FROM JDP_USER A
		<where> 1=1
		        <if test="isType == null">
		        	AND A.ISTYPE = #{isType}
		        </if>
				<if test="orgCode == null">
					AND A.org_code = #{orgCode}
				</if>
				<if test="account != null">
				AND A.ACCOUNT LIKE '%'||#{account}||'%'
				</if>
				<if test="accountstate != null">
				AND A.ACCOUNTSTATE = #{accountstate}
				</if>
				<if test="roleId != null">
				AND A.role_id = #{roleId}
				</if>
				<if test="userName != null">
				AND A.USERNAME like '%'||#{userName}||'%'
				</if>
		</where>
	</select>
	<select id="getOrgCode" parameterType="java.lang.String" resultType="java.lang.String">
	 select distinct m.shortname as shortname from comp_managecom m inner join  jdp_user u on m.managecom = u.org_code where u.org_code = #{orgCode} 
	</select>
</mapper>