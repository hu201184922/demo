<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fairyland.jdp.framework.security.mapper.ResourceMapper">
	<update id="createRelation">
		UPDATE JDP_RESOURCE SET
		PARENT_ID=#{groupId} WHERE CID=#{id}
	</update>
	<select id="getAllResource" resultType="Long">
		SELECT CID FROM
		JDP_RESOURCE B WHERE B.RES_TYPE='G' START WITH CID=#{id} CONNECT BY
		B.PARENT_ID = PRIOR B.CID
	</select>
	
	<update id="deleteParentId">
	 	UPDATE JDP_RESOURCE SET PARENT_ID=NULL WHERE CID IN(
		SELECT CID FROM
		JDP_RESOURCE B START WITH CID=#{id} CONNECT BY
		B.PARENT_ID = PRIOR B.CID)
	</update>
	
	<delete id="deleteResourceById">
		BEGIN
		DELETE FROM JDP_MT_ROLE_RES WHERE RES_ID=#{id};
		DELETE FROM JDP_RESOURCE WHERE CID=#{id};
		END;
	</delete>
</mapper>